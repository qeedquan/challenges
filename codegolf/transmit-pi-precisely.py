#!/usr/bin/env python3

"""

Following on from Monte Carlo estimator of Pi this challenge is to produce the shortest code for the constant Pi. Except here your code must output consecutive digits of pi forever.

This is code golf, so the shortest submission (in bytes) wins except that it must output the first 10,000 digits in less than 10 seconds on a reasonable PC and it must never terminate.

You can't use any built-in for Pi or trig functions.

Removed the hard limit on code size.

"""

# https://www.cs.ox.ac.uk/jeremy.gibbons/publications/spigot.pdf
class Spigot:
    def __init__(self):
        self.q = 1
        self.r = 180
        self.t = 60
        self.i = 2

    def next(self):
        q = self.q
        r = self.r
        t = self.t
        i = self.i

        u = 27*i*(i+1) + 6
        y = (q*(27*i - 12) + 5*r) // (5*t)

        self.q = 10*q*i*(2*i - 1)
        self.r = 10*u*(q*(5*i - 2) + r - y*t)
        self.t = t * u
        self.i = i + 1
        
        return y

def gen(n):
    s = Spigot()
    r = ""
    for _ in range(n):
        r += "%d" % (s.next())
    return r

def main():
    PI = "31415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989"

    assert(gen(len(PI)) == PI)

main()
